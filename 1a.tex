\section{Алгоритм моделирования процесса коагуляции схемой испытаний 
Бернулли с использованием весовых множителей.}

В работах Королева-Яницкого было впервые предложено использовать схему 
испытаний Бернулли для моделирования химических реакций. Как показали 
численные эксперименты, расчеты можно проводить при небольшом числе 
частиц и избежать сильного влияния квадратичной зависимости. С другой 
стороны в задачах кластерообразования в результате взаимодействия частиц 
возникает множество сортов кластеров различающихся по массам и диаметрам 
и в расчетах приходится сталкиваться с проблемой квадратичной зависимости 
от количества реагирующих смесей. Для решения этой проблемы можно 
использовать не фиксированные сорта частиц, а переменные: наряду с 
индивидуальными характеристиками частицы, такими как скорость или вес, 
можно использовать и сорт, к которому она принадлежит. 
 
 
Рассмотрим эту схему для моделирования дискретного уравнения Смолуховского. Будем решать задачу Коши следующего вида:

\begin{equation}
\left\{ \begin{split}
	&\frac{\partial n(l, t)}{\partial t} = \frac{1}{2}\sum_{i=1}^{l-1}K(l-i, i) n(i, t) n(l-i,t) - \sum_{i=1}^{\infty} K(l, i) n(l, t) n(i, t) \\
	&n(l, 0) = \phi(l)
	\end{split}
\right.
\end{equation},

где $n(l, t)$ - концентрация кластеров, состоящих из $l$ частиц в момент времени $t$, а $K(x, y)$ - ядро коагуляции,
которое определяет скорость с которой частицы размером $x$ взаимодействуют с частицами размером $y$. Из физических
соображений полагают, что $K(x, y) = K(y, x)$.

Для удобства изложения введем следующие термины. 
Модельная частица $p$ - это пара чисел $(l, w)$, где $l \in \mathbb{N}$ - 
определяет размер кластеров, которые представляет модельная частица, а $w \in \mathbb{R}_{+}$ - определяет ее вес, 
т.е. количество кластеров, которые она представляет.\\
$l(p)$ - функция, возвращающая размер кластеров, которые представляет модельная частица $p$\\
$w(p)$ - функция, возвращающая вес $p$.

Концентрацией кластеров размером $l$ в системе из $N$ частиц будет функция $n(l) = \sum_{i=1}^{N}w(p_i) [ l(p_i) = l]$. 
$[x]$ - нотация Айверсона, равная 1, если выражение $x$ - истинно и 0, если ложно.

Реализация схемы Бернулли - множество ячеек из $M$ модельных частиц, проиндексированных параметром $t \in T$.

Столкновение двух частиц - функция, отображающая частицы $p_i$ и $p_j$ в себя следующим образом(для удобства $w(p_i) < w(p_j))$:
\begin{equation*}
\left(
\begin{split}
w(x), l(x)\\
w(y), l(y)
\end{split}\right)
\rightarrow
\left(
\begin{split}
& w(x),& l(x) + l(y)\\
& w(y) - w(x),& l(x)
\end{split}\right)
\end{equation*}


Суммарная масса частиц при этом не меняется:
$w(x) l(x) +  w(y) l(y) = w(x)(l(x) + l(y)) +  (w(y) - w(x)) l(x)$

Эволюцию модели на временном шаге $\Delta t$ будем рассчитывать по следующему алгоритму.
В системе из $N$ частиц для всех возможных пар частиц $(p_i, p_j)$ выполняются следующие процедуры:
\begin{description}
\item[Шаг 1.] Разыгрывается факт взаимодействия с вероятностью $$P = K(l(p_i), l(p_j)) \max (w(p_i), w(p_j)) \Delta t$$
\item[Шаг 2.] Если взаимодействие произошло, то частицы заменяются на новые, в соответствии с функцией столкновения. 
В противном случае параметры частиц не меняются.
\end{description}


Основная цель(из соображений численного моделирования) сохранить постоянное число модельных частиц.
В силу парности взаимодействия, и неравенстве весов нужно позаботиться о правильном определении новых сортов. 


Алгоритм моделирования выглядит следующим образом:
При столкновении может произойти два несовместных события:
\begin{enumerate}
\item Вес частицы уменьшится, а сорт не изменится.
$$
w_i^* = w_i - \frac12 \min (w_i, w_j)
$$
$$
p(w_i \rightarrow w_i^*, l_i = const) = 1 - \frac{\frac12 \min(w_i, w_j)}{w_i^*}
$$
\item Вес уменьшится, сорт изменится.
$$
w_i^* = w_i - {\frac12} \min (w_i, w_j)
$$
$$
p(w_i \rightarrow w_i^*, l_i \rightarrow l_i + l_j) = \frac{\frac12 \min (w_i, w_j)}{w_i^*}
$$
\end{enumerate}

При таком способе получаем консервативность ``в среднем'' для веса слипшихся частиц (для удобства $w_i > w_j$):
$$
\mathbb{E} w(l_i+l_j) = w_i^* \cdot p(l_i \rightarrow l_i+l_j) + \frac12 w_j = w_i^ * \frac{w_j}{2 w_i^*} + \frac12 w_j = w_j
$$


