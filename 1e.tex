\section{Схема моделирования дискретного многокомпонентного уравнения
Смолуховского испытаниями Бернулли.}

Для исследования многокомпонентных процессов кластерообразования 
приведенная схема допускает естественное обобщение: вместо фиксации 
одного сорта части, можно представить ее сорт в виде вектора в пространтве
$\mathbb{N}^p$, где $p$ - число компонент смеси. Без ограничения общности 
представим алгоритм моделирования для двукомпонентного случая.


Уравнение Смолуховского для двукомпонентного случая будет выглядеть следующим образом:
\begin{equation}
\frac{\partial \phi(v_x, v_y, t)}{\partial t} = \frac{1}{2}\sum_{l_x = 1}^{v_x - 1} \sum_{l_y = 0}{v_y - 1} K(l_x, l_y, v_x - l_x, v_y - l_y) \phi(l_x, l_y, t) \phi(v_x - l_x, v_y - l_y, t) - \phi(v_x, v_y, t) \sum_{l_x = 1}^{\infty}\sum_{l_y = 1}^{\infty} K(l_x, l_y, v_x, v_y) \phi (l_x, l_y, t)
\end{equation}

Для решения уравнения (2) рассмотрим следующую модификацию весового алгоритма:
Модельная частица $p$ - это тройка чисел $(l_x, l_y, w)$, где $l_x, l_y \in \mathbb{N}$ - 
определяет размеры кластеров, которые представляет модельная частица, а $w \in \mathbb{R}_{+}$ - определяет ее вес, 
т.е. количество кластеров, которые она представляет.\\
$l_x(p)$ - функция, возвращающая размер кластеров сорта $x$, которые представляет модельная частица $p$\\
$w(p)$ - функция, возвращающая вес $p$.

Концентрацией кластеров размером $l$ в системе из $N$ частиц будет функция $n(l) = \sum_{i=1}^{N}w(p_i) [ l(p_i) = l]$. 

Реализация схемы Бернулли - множество ячеек из $M$ модельных частиц, проиндексированных параметром $t \in T$.

Столкновение двух частиц - функция, отображающая частицы $p_i$ и $p_j$ в себя следующим образом(для удобства $w(p_i) < w(p_j))$:
\begin{equation*}
\left(
\begin{split}
w(x), l(x)\\
w(y), l(y)
\end{split}\right)
\rightarrow
\left(
\begin{split}
& w(x),& l(x) + l(y)\\
& w(y) - w(x),& l(x)
\end{split}\right)
\end{equation*}


Суммарная масса частиц при этом не меняется:
$w(x) l(x) +  w(y) l(y) = w(x)(l(x) + l(y)) +  (w(y) - w(x)) l(x)$

Эволюцию модели на временном шаге $\Delta t$ будем рассчитывать по следующему алгоритму.
В системе из $N$ частиц для всех возможных пар частиц $(p_i, p_j)$ выполняются следующие процедуры:
\begin{description}
\item[Шаг 1.] Разыгрывается факт взаимодействия с вероятностью $$P = K(l(p_i), l(p_j)) \max (w(p_i), w(p_j)) \Delta t$$
\item[Шаг 2.] Если взаимодействие произошло, то частицы заменяются на новые, в соответствии с функцией столкновения. 
В противном случае параметры частиц не меняются.
\end{description}


Основная цель(из соображений численного моделирования) сохранить постоянное число модельных частиц.
В силу парности взаимодействия, и неравенстве весов нужно позаботиться о правильном определении новых сортов. 


Алгоритм моделирования выглядит следующим образом:
При столкновении может произойти два несовместных события:
\begin{enumerate}
\item Вес частицы уменьшится, а сорт не изменится.
$$
w_i^* = w_i - \frac12 \min (w_i, w_j)
$$
$$
p(w_i \rightarrow w_i^*, l_i = const) = 1 - \frac{\frac12 \min(w_i, w_j)}{w_i^*}
$$
\item Вес уменьшится, сорт изменится.
$$
w_i^* = w_i - {\frac12} \min (w_i, w_j)
$$
$$
p(w_i \rightarrow w_i^*, l_i \rightarrow l_i + l_j) = \frac{\frac12 \min (w_i, w_j)}{w_i^*}
$$
\end{enumerate}

При таком способе получаем консервативность ``в среднем'' для веса слипшихся частиц (для удобства $w_i > w_j$):
$$
\mathbb{E} w(l_i+l_j) = w_i^* \cdot p(l_i \rightarrow l_i+l_j) + \frac12 w_j = w_i^ * \frac{w_j}{2 w_i^*} + \frac12 w_j = w_j
$$


